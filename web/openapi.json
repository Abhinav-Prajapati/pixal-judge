{"openapi":"3.1.0","info":{"title":"Image Clustering API","description":"An API for uploading, processing, and clustering images.","version":"1.0.0"},"paths":{"/images/upload":{"post":{"tags":["Images"],"summary":"Upload Images","description":"Uploads one or more image files and processes them in the background.","operationId":"uploadImages","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_uploadImages"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/ImageResponse"},"type":"array","title":"Response Uploadimages"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/images/":{"get":{"tags":["Images"],"summary":"Get All Images","operationId":"getAllImages","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/ImageResponse"},"type":"array","title":"Response Getallimages"}}}}}}},"/images/{image_id}":{"get":{"tags":["Images"],"summary":"Get Image File","description":"Returns the full-size image file.","operationId":"getImageFile","parameters":[{"name":"image_id","in":"path","required":true,"schema":{"type":"integer","title":"Image Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["Images"],"summary":"Delete Image","operationId":"deleteImage","parameters":[{"name":"image_id","in":"path","required":true,"schema":{"type":"integer","title":"Image Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/images/thumbnail/{image_id}":{"get":{"tags":["Images"],"summary":"Get Thumbnail File","description":"Returns the thumbnail image file.","operationId":"getImageThumbnail","parameters":[{"name":"image_id","in":"path","required":true,"schema":{"type":"integer","title":"Image Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/images/metadata/{image_id}":{"get":{"tags":["Images"],"summary":"Get Image Metadata","description":"Returns detailed EXIF metadata for an image.","operationId":"getImageMetadata","parameters":[{"name":"image_id","in":"path","required":true,"schema":{"type":"integer","title":"Image Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Metadata"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/images/quality/{image_id}":{"get":{"tags":["Images"],"summary":"Get Image Quality","description":"Get or calculate image quality score.\n\n- Returns cached score if available and metric matches\n- Calculates new score if not cached or force_reanalyze=True\n- Supported metrics: liqe, clipiqa+, brisque, niqe, musiq, cnniqa","operationId":"get_image_quality_images_quality__image_id__get","parameters":[{"name":"image_id","in":"path","required":true,"schema":{"type":"integer","title":"Image Id"}},{"name":"metric","in":"query","required":false,"schema":{"type":"string","default":"brisque","title":"Metric"}},{"name":"force_reanalyze","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Force Reanalyze"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ImageQualityResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/images/quality/batch":{"post":{"tags":["Images"],"summary":"Analyze Batch Quality","description":"Analyze quality for multiple images at once.","operationId":"analyzeBatchQuality","parameters":[{"name":"metric","in":"query","required":false,"schema":{"type":"string","default":"liqe","title":"Metric"}},{"name":"force_reanalyze","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Force Reanalyze"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"array","items":{"type":"integer"},"title":"Image Ids"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/ImageQualityResponse"},"title":"Response Analyzebatchquality"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/batches/":{"get":{"tags":["Grouping Batches"],"summary":"Get All Batches","description":"Returns all batches.","operationId":"getAllBatches","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/BatchResponse"},"type":"array","title":"Response Getallbatches"}}}}}},"post":{"tags":["Grouping Batches"],"summary":"Create Batch","description":"Creates a new batch with the specified images.","operationId":"createBatch","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/batches/{batch_id}":{"get":{"tags":["Grouping Batches"],"summary":"Get Batch Details","description":"Returns details for a specific batch.","operationId":"getBatch","parameters":[{"name":"batch_id","in":"path","required":true,"schema":{"type":"integer","title":"Batch Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"put":{"tags":["Grouping Batches"],"summary":"Rename Batch","description":"Renames an existing batch.","operationId":"renameBatch","parameters":[{"name":"batch_id","in":"path","required":true,"schema":{"type":"integer","title":"Batch Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchRename"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["Grouping Batches"],"summary":"Delete Batch","description":"Deletes a batch.","operationId":"deleteBatch","parameters":[{"name":"batch_id","in":"path","required":true,"schema":{"type":"integer","title":"Batch Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/batches/{batch_id}/images":{"post":{"tags":["Grouping Batches"],"summary":"Add Images To Batch","description":"Adds existing images to a batch.","operationId":"addImagesToBatch","parameters":[{"name":"batch_id","in":"path","required":true,"schema":{"type":"integer","title":"Batch Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchUpdateImages"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["Grouping Batches"],"summary":"Remove Images From Batch","description":"Removes images from a batch.","operationId":"removeImagesFromBatch","parameters":[{"name":"batch_id","in":"path","required":true,"schema":{"type":"integer","title":"Batch Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchUpdateImages"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/batches/{batch_id}/upload-and-add":{"post":{"tags":["Grouping Batches"],"summary":"Upload And Add To Batch","description":"Uploads new images and adds them to the batch.","operationId":"uploadAndAddImagesToBatch","parameters":[{"name":"batch_id","in":"path","required":true,"schema":{"type":"integer","title":"Batch Id"}}],"requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_uploadAndAddImagesToBatch"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/batches/{batch_id}/analyze":{"put":{"tags":["Grouping Batches"],"summary":"Analyze Batch","description":"Analyzes a batch using clustering to group similar images.","operationId":"analyzeBatch","parameters":[{"name":"batch_id","in":"path","required":true,"schema":{"type":"integer","title":"Batch Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchAnalyze"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/batches/{batch_id}/groups":{"put":{"tags":["Grouping Batches"],"summary":"Update Groups","description":"Manually updates the group assignments for images in a batch.","operationId":"updateGroupsInBatch","parameters":[{"name":"batch_id","in":"path","required":true,"schema":{"type":"integer","title":"Batch Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchGroupUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/":{"get":{"tags":["Root"],"summary":"Read Root","description":"A simple health check endpoint.","operationId":"read_root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"BatchAnalyze":{"properties":{"min_cluster_size":{"type":"integer","title":"Min Cluster Size","default":5},"min_samples":{"type":"integer","title":"Min Samples","default":5},"metric":{"type":"string","title":"Metric","default":"cosine"}},"type":"object","title":"BatchAnalyze","description":"Schema for the analysis request using HDBSCAN parameters."},"BatchCreate":{"properties":{"name":{"type":"string","title":"Name"},"image_ids":{"items":{"type":"integer"},"type":"array","title":"Image Ids"}},"type":"object","required":["name","image_ids"],"title":"BatchCreate","description":"Schema for the initial creation of a batch."},"BatchGroupUpdate":{"properties":{"group_map":{"additionalProperties":{"items":{"type":"integer"},"type":"array"},"type":"object","title":"Group Map"}},"type":"object","required":["group_map"],"title":"BatchGroupUpdate","description":"Schema for manually updating a batch's group map."},"BatchRename":{"properties":{"name":{"type":"string","title":"Name"}},"type":"object","required":["name"],"title":"BatchRename","description":"Schema for renaming a batch."},"BatchResponse":{"properties":{"id":{"type":"integer","title":"Id"},"batch_name":{"type":"string","title":"Batch Name"},"status":{"type":"string","title":"Status"},"parameters":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Parameters"},"image_associations":{"items":{"$ref":"#/components/schemas/GroupAssociationResponse"},"type":"array","title":"Image Associations"}},"type":"object","required":["id","batch_name","status","parameters","image_associations"],"title":"BatchResponse","description":"Schema for returning full batch details."},"BatchUpdateImages":{"properties":{"image_ids":{"items":{"type":"integer"},"type":"array","title":"Image Ids"}},"type":"object","required":["image_ids"],"title":"BatchUpdateImages","description":"Schema for adding/removing images from a batch."},"Body_uploadAndAddImagesToBatch":{"properties":{"files":{"items":{"type":"string","format":"binary"},"type":"array","title":"Files"}},"type":"object","required":["files"],"title":"Body_uploadAndAddImagesToBatch"},"Body_uploadImages":{"properties":{"files":{"items":{"type":"string","format":"binary"},"type":"array","title":"Files"}},"type":"object","required":["files"],"title":"Body_uploadImages"},"GroupAssociationResponse":{"properties":{"image":{"$ref":"#/components/schemas/ImageResponse"},"group_label":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Group Label"}},"type":"object","required":["image","group_label"],"title":"GroupAssociationResponse","description":"Schema for an image's association within a batch, including its group."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"ImageQualityResponse":{"properties":{"image_id":{"type":"integer","title":"Image Id"},"quality_score":{"type":"number","title":"Quality Score"},"quality_metric":{"type":"string","title":"Quality Metric"},"analyzed_at":{"type":"string","format":"date-time","title":"Analyzed At"},"file_name":{"type":"string","title":"File Name"}},"type":"object","required":["image_id","quality_score","quality_metric","analyzed_at","file_name"],"title":"ImageQualityResponse","description":"Response with image quality score."},"ImageResponse":{"properties":{"id":{"type":"integer","title":"Id"},"filename":{"type":"string","title":"Filename"},"original_filename":{"type":"string","title":"Original Filename"},"file_path":{"type":"string","title":"File Path"},"has_thumbnail":{"type":"boolean","title":"Has Thumbnail"},"is_duplicate":{"type":"boolean","title":"Is Duplicate","default":false},"message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Message"},"quality_score":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Quality Score"},"quality_metric":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Quality Metric"}},"type":"object","required":["id","filename","original_filename","file_path","has_thumbnail"],"title":"ImageResponse","description":"Schema for returning image details. This model is unchanged."},"Metadata":{"properties":{"width":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Width"},"height":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Height"},"orientation":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Orientation"},"shot_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Shot At"},"latitude":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Latitude"},"longitude":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Longitude"},"camera_make":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Camera Make"},"camera_model":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Camera Model"},"focal_length":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Focal Length"},"f_number":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"F Number"},"exposure_time":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Exposure Time"},"iso":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Iso"},"caption":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Caption"},"tags":{"anyOf":[{},{"type":"null"}],"title":"Tags"},"rating":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Rating"}},"type":"object","title":"Metadata","description":"Schema for detailed image metadata."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}